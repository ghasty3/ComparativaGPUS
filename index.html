<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Performance Hierarchy Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PapaParse CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        charcoal: {
                            900: '#0a0a0a',
                            800: '#141414',
                            700: '#1a1a1a',
                            600: '#262626',
                            500: '#333333',
                            400: '#404040',
                        },
                        emerald: {
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0a0a0a;
            color: #e5e5e5;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #141414;
        }
        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #404040;
        }

        /* Performance bar animation */
        .performance-bar {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Row hover effect */
        .gpu-row {
            transition: all 0.2s ease;
        }
        .gpu-row:hover {
            background-color: #1a1a1a;
            transform: translateX(4px);
        }
        .gpu-row.active {
            background-color: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
        }

        /* Glass effect for header */
        .glass-header {
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
        }

        /* Input styling */
        .custom-input {
            background-color: #1a1a1a;
            border: 1px solid #333333;
            transition: all 0.2s ease;
        }
        .custom-input:focus {
            border-color: #10b981;
            outline: none;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        /* Smooth fade in */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.4s ease forwards;
        }

        /* Tab styling */
        .tab-btn {
            transition: all 0.2s ease;
        }
        .tab-btn.active {
            background-color: #10b981;
            color: white;
        }

        /* Sortable header */
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            color: #10b981;
        }
        .sort-icon {
            display: inline-block;
            margin-left: 4px;
            font-size: 10px;
            opacity: 0.5;
        }
        .sortable.active .sort-icon {
            opacity: 1;
            color: #10b981;
        }

        /* Price comparison card */
        .price-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #262626 100%);
            border: 1px solid #333333;
        }
        .price-card:hover {
            border-color: #10b981;
        }
    </style>
<base target="_blank">
</head>
<body class="min-h-screen font-sans antialiased">
    <!-- Header -->
    <header class="glass-header fixed top-0 left-0 right-0 z-50 border-b border-charcoal-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white tracking-tight">GPU Performance Hierarchy</h1>
                        <p class="text-xs text-gray-400">Herramienta de comparación de rendimiento</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="loadDemoBtn" class="px-4 py-2 text-sm font-medium text-emerald-400 hover:text-emerald-300 transition-colors">
                        Cargar Datos Demo
                    </button>
                    <label class="cursor-pointer px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        Cargar CSV
                        <input type="file" id="csvInput" accept=".csv" class="hidden">
                    </label>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Tab Navigation -->
        <div class="mb-6 flex gap-2">
            <button id="tabHierarchy" class="tab-btn active px-6 py-3 rounded-lg text-sm font-medium bg-charcoal-700 text-gray-300 hover:text-white">
                Jerarquía de GPUs
            </button>
            <button id="tabPriceCompare" class="tab-btn px-6 py-3 rounded-lg text-sm font-medium bg-charcoal-700 text-gray-300 hover:text-white">
                Comparador por Precio
            </button>
        </div>

        <!-- TAB 1: Hierarchy View -->
        <div id="hierarchyView">
            <!-- Reference Info Banner -->
            <div id="refBanner" class="hidden mb-6 p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/30">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-emerald-400">GPU de Referencia Seleccionada</p>
                            <p id="refName" class="text-lg font-bold text-white"></p>
                        </div>
                    </div>
                    <button id="clearRefBtn" class="px-3 py-1.5 text-sm text-gray-400 hover:text-white transition-colors">
                        Limpiar referencia
                    </button>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="relative">
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input type="text" id="searchInput" placeholder="Buscar GPU..." 
                        class="custom-input w-full pl-10 pr-4 py-2.5 rounded-lg text-sm text-white placeholder-gray-500">
                </div>
                <select id="vendorFilter" class="custom-input w-full px-4 py-2.5 rounded-lg text-sm text-white">
                    <option value="">Todos los Vendors</option>
                    <option value="NVIDIA">NVIDIA</option>
                    <option value="AMD">AMD</option>
                    <option value="Intel">Intel</option>
                </select>
                <select id="typeFilter" class="custom-input w-full px-4 py-2.5 rounded-lg text-sm text-white">
                    <option value="">Todos los Tipos</option>
                    <option value="Desktop">Desktop</option>
                    <option value="Laptop">Laptop</option>
                    <option value="Workstation">Workstation</option>
                </select>
                <select id="archFilter" class="custom-input w-full px-4 py-2.5 rounded-lg text-sm text-white">
                    <option value="">Todas las Arquitecturas</option>
                </select>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-charcoal-800 rounded-xl p-4 border border-charcoal-600">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Total GPUs</p>
                    <p id="totalGPUs" class="text-2xl font-bold text-white mt-1">-</p>
                </div>
                <div class="bg-charcoal-800 rounded-xl p-4 border border-charcoal-600">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Score Máximo</p>
                    <p id="maxScore" class="text-2xl font-bold text-emerald-400 mt-1">-</p>
                </div>
                <div class="bg-charcoal-800 rounded-xl p-4 border border-charcoal-600">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Score Promedio</p>
                    <p id="avgScore" class="text-2xl font-bold text-white mt-1">-</p>
                </div>
                <div class="bg-charcoal-800 rounded-xl p-4 border border-charcoal-600">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Mejor P/R</p>
                    <p id="bestValue" class="text-2xl font-bold text-emerald-400 mt-1">-</p>
                </div>
            </div>

            <!-- Table Container -->
            <div class="bg-charcoal-800 rounded-xl border border-charcoal-600 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-charcoal-700">
                            <tr>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider" data-sort="name">
                                    GPU<span class="sort-icon">↕</span>
                                </th>
                                <th class="px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Vendor</th>
                                <th class="px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Arquitectura</th>
                                <th class="px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Tipo</th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider" data-sort="shaders">
                                    Shaders<span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider" data-sort="clock">
                                    Clock<span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider" data-sort="tdp">
                                    TDP<span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider" data-sort="price">
                                    Precio 2ª Mano<span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider w-48" data-sort="score">
                                    Rendimiento<span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable px-4 py-4 text-left text-xs font-semibold text-emerald-400 uppercase tracking-wider w-40" data-sort="value">
                                    Precio/Rend.<span class="sort-icon">↕</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="gpuTableBody" class="divide-y divide-charcoal-600">
                            <tr>
                                <td colspan="10" class="px-6 py-12 text-center text-gray-500">
                                    <div class="flex flex-col items-center gap-3">
                                        <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <p>Carga un archivo CSV o usa los datos de demostración</p>
                                        <p class="text-sm text-gray-600">Formato: name, shaders, clock, arquitecture, gpu_type, vendor, TDP (W), buy_price_p10</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 2: Price Comparison View -->
        <div id="priceCompareView" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Panel: GPU Selection -->
                <div class="lg:col-span-1 space-y-4">
                    <div class="bg-charcoal-800 rounded-xl p-6 border border-charcoal-600">
                        <h3 class="text-lg font-semibold text-white mb-4">Configurar Comparación</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Seleccionar GPU</label>
                                <select id="priceCompareGPU" class="custom-input w-full px-4 py-3 rounded-lg text-sm text-white">
                                    <option value="">-- Selecciona una GPU --</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Precio encontrado (€)</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">€</span>
                                    <input type="number" id="customPrice" placeholder="Ej: 350" 
                                        class="custom-input w-full pl-8 pr-4 py-3 rounded-lg text-sm text-white placeholder-gray-500">
                                </div>
                            </div>
                            
                            <button id="addPriceCompareBtn" class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-medium rounded-lg transition-colors">
                                Añadir a Comparación
                            </button>
                        </div>
                    </div>

                    <!-- Selected GPUs for Comparison -->
                    <div class="bg-charcoal-800 rounded-xl p-6 border border-charcoal-600">
                        <h3 class="text-lg font-semibold text-white mb-4">GPUs a Comparar</h3>
                        <div id="selectedGPUsList" class="space-y-2">
                            <p class="text-sm text-gray-500 text-center py-4">No hay GPUs seleccionadas</p>
                        </div>
                        <button id="clearAllCompareBtn" class="w-full mt-4 py-2 text-sm text-gray-400 hover:text-white transition-colors hidden">
                            Limpiar todas
                        </button>
                    </div>
                </div>

                <!-- Right Panel: Comparison Results -->
                <div class="lg:col-span-2">
                    <div class="bg-charcoal-800 rounded-xl p-6 border border-charcoal-600 min-h-[500px]">
                        <h3 class="text-lg font-semibold text-white mb-4">Resultados de Comparación</h3>
                        
                        <div id="comparisonResults" class="space-y-3">
                            <div class="text-center py-12 text-gray-500">
                                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <p>Selecciona GPUs y añade precios para comparar</p>
                                <p class="text-sm text-gray-600 mt-2">Descubre cuál ofrece mejor rendimiento por euro</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Footer -->
        <div class="mt-6 text-center text-sm text-gray-500">
            <p id="footerText">Haz clic en cualquier GPU para establecerla como referencia (100%)</p>
        </div>
    </main>

    <script>
        // ============================================
        // MULTIPLICADORES DE ARQUITECTURA (IPC 2026)
        // Basado en datos reales de benchmarks 2024-2025
        // ============================================
        const ARCH_MULTIPLIERS = {
            // NVIDIA Architectures
            'Ada Lovelace': 1.30,
            'Blackwell': 1.45,
            'Ampere': 1.10,
            'Turing': 0.95,
            'Pascal': 0.70,
            'Volta': 0.85,
            'Maxwell': 0.55,
            'Maxwell 1.0': 0.53,
            'Kepler': 0.42,
            // AMD Architectures - Ajustados para reflejar rendimiento real
            'RDNA 3': 1.50,      // Muy eficiente en rasterización
            'RDNA 3.5': 1.60,    // Mejoras incrementales
            'RDNA 2': 1.10,      // Competitivo con Ampere
            'RDNA': 0.85,
            'GCN 5': 0.60,
            'GCN 4': 0.55,
            // Intel Architectures
            'Xe HPG': 0.90,
            'Xe2': 1.05,
            'Battlemage': 1.15,
            // Default
            'Unknown': 1.00
        };

        // Vendor multipliers - AMD RDNA 3 es muy competitivo en rasterización
        const VENDOR_MULTIPLIERS = {
            'NVIDIA': 1.00,
            'AMD': 1.00,    // RDNA 3 está al mismo nivel que Ada Lovelace en rasterización
            'Intel': 0.95
        };

        // ============================================
        // DEMO DATA - GPUs 2026
        // ============================================
        const DEMO_CSV = `name,shaders,clock,arquitecture,gpu_type,vendor,TDP (W),buy_price_p10
RTX 5090,24576,2900,Blackwell,Desktop,NVIDIA,575,2500
RTX 5080,16384,2800,Blackwell,Desktop,NVIDIA,360,1200
RTX 5070 Ti,12288,2700,Blackwell,Desktop,NVIDIA,300,850
RTX 5070,9216,2650,Blackwell,Desktop,NVIDIA,250,650
RTX 4090,16384,2520,Ada Lovelace,Desktop,NVIDIA,450,1800
RTX 4080 Super,10240,2610,Ada Lovelace,Desktop,NVIDIA,320,1050
RTX 4080,9728,2505,Ada Lovelace,Desktop,NVIDIA,320,900
RTX 4070 Ti Super,8448,2610,Ada Lovelace,Desktop,NVIDIA,285,800
RTX 4070 Ti,7680,2610,Ada Lovelace,Desktop,NVIDIA,285,650
RTX 4070 Super,7168,2475,Ada Lovelace,Desktop,NVIDIA,220,550
RTX 4070,5888,2475,Ada Lovelace,Desktop,NVIDIA,200,480
RTX 3090 Ti,10752,1860,Ampere,Desktop,NVIDIA,450,700
RTX 3090,10496,1695,Ampere,Desktop,NVIDIA,350,550
RTX 3080 Ti,10240,1665,Ampere,Desktop,NVIDIA,350,500
RTX 3080,8704,1710,Ampere,Desktop,NVIDIA,320,400
RTX 3070 Ti,6144,1770,Ampere,Desktop,NVIDIA,290,320
RTX 3070,5888,1725,Ampere,Desktop,NVIDIA,220,280
RX 8900 XTX,8192,3100,RDNA 3.5,Desktop,AMD,450,1100
RX 8800 XT,6144,2950,RDNA 3.5,Desktop,AMD,350,750
RX 8700 XT,4608,2800,RDNA 3.5,Desktop,AMD,260,550
RX 7900 XTX,6144,2500,RDNA 3,Desktop,AMD,355,850
RX 7900 XT,5376,2400,RDNA 3,Desktop,AMD,315,700
RX 7800 XT,3840,2430,RDNA 3,Desktop,AMD,263,450
RX 7700 XT,3456,2544,RDNA 3,Desktop,AMD,245,380
RX 6950 XT,5120,2316,RDNA 2,Desktop,AMD,335,400
RX 6900 XT,5120,2250,RDNA 2,Desktop,AMD,300,350
RX 6800 XT,4608,2250,RDNA 2,Desktop,AMD,300,320
RX 6800,3840,2105,RDNA 2,Desktop,AMD,250,280
RX 6750 XT,2560,2623,RDNA 2,Desktop,AMD,250,220
RX 6700 XT,2560,2581,RDNA 2,Desktop,AMD,230,200
Arc B580,2560,2800,Battlemage,Desktop,Intel,190,250
Arc A770,4096,2400,Xe HPG,Desktop,Intel,225,200
Arc A750,3584,2400,Xe HPG,Desktop,Intel,225,180
RTX 5090 Laptop,20480,2400,Blackwell,Laptop,NVIDIA,175,2200
RTX 5080 Laptop,16384,2300,Blackwell,Laptop,NVIDIA,150,1400
RTX 4090 Laptop,9728,2040,Ada Lovelace,Laptop,NVIDIA,150,1300
RTX 4080 Laptop,7424,2010,Ada Lovelace,Laptop,NVIDIA,150,950
RX 8900M,5120,2400,RDNA 3.5,Laptop,AMD,160,900
RX 7900M,4608,2200,RDNA 3,Laptop,AMD,180,750`;

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let gpuData = [];
        let referenceGPU = null;
        let filters = {
            search: '',
            vendor: '',
            type: '',
            architecture: ''
        };
        let sortConfig = {
            column: 'score',
            direction: 'desc'
        };
        let priceCompareList = [];
        let currentTab = 'hierarchy';

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function calculateScore(gpu) {
            const shaders = parseInt(gpu.shaders) || 0;
            const clock = parseInt(gpu.clock) || 0;
            const archMultiplier = ARCH_MULTIPLIERS[gpu.arquitecture] || ARCH_MULTIPLIERS['Unknown'];
            const vendorMultiplier = VENDOR_MULTIPLIERS[gpu.vendor] || 1.00;
            return Math.round(shaders * clock * archMultiplier * vendorMultiplier / 1000000 * 100) / 100;
        }

        function calculateValue(gpu) {
            const price = parseFloat(gpu.buy_price_p10) || 0;
            if (price === 0 || gpu.score === 0) return 0;
            return Math.round(gpu.score / price * 1000 * 100) / 100;
        }

        function getBarColor(percentage) {
            if (percentage >= 90) return 'bg-emerald-500';
            if (percentage >= 70) return 'bg-emerald-400';
            if (percentage >= 50) return 'bg-yellow-500';
            if (percentage >= 30) return 'bg-orange-500';
            return 'bg-red-500';
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function formatPrice(price) {
            if (!price || price === 0) return '-';
            return '€' + formatNumber(price);
        }

        // ============================================
        // TAB MANAGEMENT
        // ============================================
        
        function switchTab(tab) {
            currentTab = tab;
            const hierarchyView = document.getElementById('hierarchyView');
            const priceCompareView = document.getElementById('priceCompareView');
            const tabHierarchy = document.getElementById('tabHierarchy');
            const tabPriceCompare = document.getElementById('tabPriceCompare');
            const footerText = document.getElementById('footerText');

            if (tab === 'hierarchy') {
                hierarchyView.classList.remove('hidden');
                priceCompareView.classList.add('hidden');
                tabHierarchy.classList.add('active');
                tabPriceCompare.classList.remove('active');
                footerText.textContent = 'Haz clic en cualquier GPU para establecerla como referencia (100%)';
            } else {
                hierarchyView.classList.add('hidden');
                priceCompareView.classList.remove('hidden');
                tabHierarchy.classList.remove('active');
                tabPriceCompare.classList.add('active');
                footerText.textContent = 'Añade GPUs con sus precios para comparar el rendimiento por euro';
                updatePriceCompareDropdown();
            }
        }

        // ============================================
        // SORTING FUNCTIONS
        // ============================================
        
        function handleSort(column) {
            if (sortConfig.column === column) {
                sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortConfig.column = column;
                sortConfig.direction = 'desc';
            }
            
            // Update UI
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('active');
                const icon = th.querySelector('.sort-icon');
                icon.textContent = '↕';
            });
            
            const activeTh = document.querySelector(`[data-sort="${column}"]`);
            if (activeTh) {
                activeTh.classList.add('active');
                activeTh.querySelector('.sort-icon').textContent = sortConfig.direction === 'asc' ? '↑' : '↓';
            }
            
            renderTable();
        }

        function sortData(data) {
            return [...data].sort((a, b) => {
                let valA, valB;
                
                switch (sortConfig.column) {
                    case 'name':
                        valA = a.name || '';
                        valB = b.name || '';
                        break;
                    case 'shaders':
                        valA = parseInt(a.shaders) || 0;
                        valB = parseInt(b.shaders) || 0;
                        break;
                    case 'clock':
                        valA = parseInt(a.clock) || 0;
                        valB = parseInt(b.clock) || 0;
                        break;
                    case 'tdp':
                        valA = parseInt(a['TDP (W)']) || 0;
                        valB = parseInt(b['TDP (W)']) || 0;
                        break;
                    case 'price':
                        valA = parseFloat(a.buy_price_p10) || 0;
                        valB = parseFloat(b.buy_price_p10) || 0;
                        break;
                    case 'score':
                        valA = a.score || 0;
                        valB = b.score || 0;
                        break;
                    case 'value':
                        valA = calculateValue(a);
                        valB = calculateValue(b);
                        break;
                    default:
                        valA = a.score || 0;
                        valB = b.score || 0;
                }
                
                if (sortConfig.direction === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        function renderTable() {
            const tbody = document.getElementById('gpuTableBody');
            
            // Apply filters
            let filtered = gpuData.filter(gpu => {
                const matchesSearch = !filters.search || 
                    gpu.name.toLowerCase().includes(filters.search.toLowerCase());
                const matchesVendor = !filters.vendor || gpu.vendor === filters.vendor;
                const matchesType = !filters.type || gpu.gpu_type === filters.type;
                const matchesArch = !filters.architecture || gpu.arquitecture === filters.architecture;
                return matchesSearch && matchesVendor && matchesType && matchesArch;
            });

            // Apply sorting
            filtered = sortData(filtered);

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="px-6 py-12 text-center text-gray-500">
                            No se encontraron GPUs con los filtros seleccionados
                        </td>
                    </tr>
                `;
                return;
            }

            // Calculate max for percentage bars
            const maxScore = referenceGPU ? referenceGPU.score : Math.max(...filtered.map(g => g.score));

            tbody.innerHTML = filtered.map((gpu, index) => {
                const percentage = referenceGPU 
                    ? (gpu.score / referenceGPU.score * 100)
                    : (gpu.score / maxScore * 100);
                const isReference = referenceGPU && gpu.name === referenceGPU.name;
                const barColor = isReference ? 'bg-emerald-500' : getBarColor(percentage);
                const barWidth = Math.max(percentage, 1);
                const value = calculateValue(gpu);
                const price = parseFloat(gpu.buy_price_p10) || 0;

                return `
                    <tr class="gpu-row ${isReference ? 'active' : ''} cursor-pointer fade-in" 
                        style="animation-delay: ${index * 0.03}s"
                        onclick="setReferenceGPU('${gpu.name}')">
                        <td class="px-4 py-4">
                            <div class="flex items-center gap-2">
                                ${isReference ? `
                                    <div class="w-5 h-5 rounded-full bg-emerald-500 flex items-center justify-center flex-shrink-0">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                ` : '<div class="w-5 flex-shrink-0"></div>'}
                                <div>
                                    <p class="text-sm font-semibold text-white">${gpu.name}</p>
                                    ${isReference ? '<span class="text-xs text-emerald-400">Ref. 100%</span>' : ''}
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-4">
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${getVendorBadgeClass(gpu.vendor)}">
                                ${gpu.vendor}
                            </span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-300">${gpu.arquitecture}</td>
                        <td class="px-4 py-4 text-sm text-gray-300">${gpu.gpu_type}</td>
                        <td class="px-4 py-4 text-sm text-gray-300 font-mono">${formatNumber(gpu.shaders)}</td>
                        <td class="px-4 py-4 text-sm text-gray-300 font-mono">${gpu.clock}</td>
                        <td class="px-4 py-4 text-sm text-gray-300">${gpu['TDP (W)']}W</td>
                        <td class="px-4 py-4 text-sm text-emerald-400 font-medium">${formatPrice(price)}</td>
                        <td class="px-4 py-4">
                            <div class="flex items-center gap-2">
                                <div class="flex-1 bg-charcoal-600 rounded-full h-2 overflow-hidden">
                                    <div class="performance-bar ${barColor} h-full rounded-full" style="width: ${barWidth}%"></div>
                                </div>
                                <span class="text-xs font-mono ${isReference ? 'text-emerald-400' : 'text-gray-400'} w-12 text-right">${percentage.toFixed(0)}%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Score: ${gpu.score.toFixed(1)}</p>
                        </td>
                        <td class="px-4 py-4">
                            <div class="flex flex-col">
                                <span class="text-sm font-bold ${getValueColorClass(value)}">${value.toFixed(2)}</span>
                                <span class="text-xs text-gray-500">pts/€</span>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            updateStats(filtered);
        }

        function getValueColorClass(value) {
            if (value >= 40) return 'text-emerald-400';
            if (value >= 30) return 'text-yellow-400';
            if (value >= 20) return 'text-orange-400';
            return 'text-red-400';
        }

        function getVendorBadgeClass(vendor) {
            const classes = {
                'NVIDIA': 'bg-green-900/50 text-green-400 border border-green-700',
                'AMD': 'bg-red-900/50 text-red-400 border border-red-700',
                'Intel': 'bg-blue-900/50 text-blue-400 border border-blue-700'
            };
            return classes[vendor] || 'bg-gray-800 text-gray-400';
        }

        function updateStats(data) {
            document.getElementById('totalGPUs').textContent = data.length;
            
            if (data.length > 0) {
                const scores = data.map(g => g.score);
                const max = Math.max(...scores);
                const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
                
                document.getElementById('maxScore').textContent = max.toFixed(1);
                document.getElementById('avgScore').textContent = avg.toFixed(1);
                
                // Best value
                const values = data.map(g => ({ name: g.name, value: calculateValue(g) }));
                values.sort((a, b) => b.value - a.value);
                const best = values[0];
                document.getElementById('bestValue').textContent = best ? best.value.toFixed(2) : '-';
            } else {
                document.getElementById('maxScore').textContent = '-';
                document.getElementById('avgScore').textContent = '-';
                document.getElementById('bestValue').textContent = '-';
            }
        }

        function updateArchFilter() {
            const archs = [...new Set(gpuData.map(g => g.arquitecture))].sort();
            const select = document.getElementById('archFilter');
            const currentVal = select.value;
            
            select.innerHTML = '<option value="">Todas las Arquitecturas</option>' + 
                archs.map(arch => `<option value="${arch}">${arch}</option>`).join('');
            
            select.value = currentVal;
        }

        // ============================================
        // PRICE COMPARISON FUNCTIONS
        // ============================================

        function updatePriceCompareDropdown() {
            const select = document.getElementById('priceCompareGPU');
            select.innerHTML = '<option value="">-- Selecciona una GPU --</option>' +
                gpuData.map(gpu => `<option value="${gpu.name}">${gpu.name}</option>`).join('');
        }

        function addPriceComparison() {
            const gpuName = document.getElementById('priceCompareGPU').value;
            const customPrice = parseFloat(document.getElementById('customPrice').value);
            
            if (!gpuName || !customPrice || customPrice <= 0) {
                alert('Por favor selecciona una GPU y introduce un precio válido');
                return;
            }
            
            const gpu = gpuData.find(g => g.name === gpuName);
            if (!gpu) return;
            
            // Check if already exists
            if (priceCompareList.some(item => item.name === gpuName)) {
                alert('Esta GPU ya está en la lista de comparación');
                return;
            }
            
            const customValue = (gpu.score / customPrice) * 1000;
            
            priceCompareList.push({
                name: gpu.name,
                score: gpu.score,
                price: customPrice,
                value: customValue,
                vendor: gpu.vendor,
                arquitecture: gpu.arquitecture
            });
            
            document.getElementById('priceCompareGPU').value = '';
            document.getElementById('customPrice').value = '';
            
            renderPriceComparison();
        }

        function removePriceComparison(index) {
            priceCompareList.splice(index, 1);
            renderPriceComparison();
        }

        function clearAllComparisons() {
            priceCompareList = [];
            renderPriceComparison();
        }

        function renderPriceComparison() {
            const listContainer = document.getElementById('selectedGPUsList');
            const resultsContainer = document.getElementById('comparisonResults');
            const clearBtn = document.getElementById('clearAllCompareBtn');
            
            if (priceCompareList.length === 0) {
                listContainer.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">No hay GPUs seleccionadas</p>';
                clearBtn.classList.add('hidden');
                resultsContainer.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <p>Selecciona GPUs y añade precios para comparar</p>
                        <p class="text-sm text-gray-600 mt-2">Descubre cuál ofrece mejor rendimiento por euro</p>
                    </div>
                `;
                return;
            }
            
            clearBtn.classList.remove('hidden');
            
            // Render selected list
            listContainer.innerHTML = priceCompareList.map((item, index) => `
                <div class="flex items-center justify-between p-3 bg-charcoal-700 rounded-lg">
                    <div>
                        <p class="text-sm font-medium text-white">${item.name}</p>
                        <p class="text-xs text-emerald-400">€${item.price} - ${item.value.toFixed(2)} pts/€</p>
                    </div>
                    <button onclick="removePriceComparison(${index})" class="text-gray-500 hover:text-red-400 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
            
            // Sort by value for results
            const sorted = [...priceCompareList].sort((a, b) => b.value - a.value);
            const maxValue = sorted[0].value;
            
            // Render results
            resultsContainer.innerHTML = sorted.map((item, index) => {
                const percentage = (item.value / maxValue * 100);
                const rankColor = index === 0 ? 'text-emerald-400' : index === 1 ? 'text-yellow-400' : index === 2 ? 'text-orange-400' : 'text-gray-400';
                const barColor = index === 0 ? 'bg-emerald-500' : index === 1 ? 'bg-yellow-500' : index === 2 ? 'bg-orange-500' : 'bg-gray-500';
                
                return `
                    <div class="price-card rounded-xl p-4 fade-in" style="animation-delay: ${index * 0.1}s">
                        <div class="flex items-center gap-4">
                            <div class="flex-shrink-0 w-10 h-10 rounded-full bg-charcoal-600 flex items-center justify-center">
                                <span class="text-lg font-bold ${rankColor}">#${index + 1}</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <p class="text-lg font-semibold text-white">${item.name}</p>
                                        <p class="text-xs text-gray-400">${item.vendor} · ${item.arquitecture}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-2xl font-bold ${getValueColorClass(item.value)}">${item.value.toFixed(2)}</p>
                                        <p class="text-xs text-gray-400">pts/€</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="flex-1 bg-charcoal-600 rounded-full h-3 overflow-hidden">
                                        <div class="performance-bar ${barColor} h-full rounded-full" style="width: ${percentage}%"></div>
                                    </div>
                                    <div class="text-right text-sm">
                                        <span class="text-emerald-400 font-medium">€${item.price}</span>
                                        <span class="text-gray-500 mx-1">·</span>
                                        <span class="text-gray-400">Score: ${item.score.toFixed(1)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        function setReferenceGPU(gpuName) {
            if (currentTab !== 'hierarchy') return;
            referenceGPU = gpuData.find(g => g.name === gpuName);
            
            if (referenceGPU) {
                document.getElementById('refBanner').classList.remove('hidden');
                document.getElementById('refName').textContent = referenceGPU.name;
            }
            
            renderTable();
        }

        function clearReference() {
            referenceGPU = null;
            document.getElementById('refBanner').classList.add('hidden');
            renderTable();
        }

        function processCSV(csvText) {
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    gpuData = results.data.map(gpu => ({
                        ...gpu,
                        score: calculateScore(gpu)
                    }));
                    
                    updateArchFilter();
                    renderTable();
                },
                error: function(error) {
                    alert('Error al procesar CSV: ' + error.message);
                }
            });
        }

        function loadDemoData() {
            processCSV(DEMO_CSV);
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.getElementById('tabHierarchy').addEventListener('click', () => switchTab('hierarchy'));
            document.getElementById('tabPriceCompare').addEventListener('click', () => switchTab('priceCompare'));
            
            // File input
            document.getElementById('csvInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    Papa.parse(file, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            gpuData = results.data.map(gpu => ({
                                ...gpu,
                                score: calculateScore(gpu)
                            }));
                            
                            updateArchFilter();
                            renderTable();
                        },
                        error: function(error) {
                            alert('Error al procesar CSV: ' + error.message);
                        }
                    });
                }
            });

            // Demo button
            document.getElementById('loadDemoBtn').addEventListener('click', loadDemoData);

            // Clear reference
            document.getElementById('clearRefBtn').addEventListener('click', clearReference);

            // Search filter
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filters.search = e.target.value;
                renderTable();
            });

            // Vendor filter
            document.getElementById('vendorFilter').addEventListener('change', function(e) {
                filters.vendor = e.target.value;
                renderTable();
            });

            // Type filter
            document.getElementById('typeFilter').addEventListener('change', function(e) {
                filters.type = e.target.value;
                renderTable();
            });

            // Architecture filter
            document.getElementById('archFilter').addEventListener('change', function(e) {
                filters.architecture = e.target.value;
                renderTable();
            });

            // Sort headers
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const column = this.dataset.sort;
                    handleSort(column);
                });
            });

            // Price comparison
            document.getElementById('addPriceCompareBtn').addEventListener('click', addPriceComparison);
            document.getElementById('clearAllCompareBtn').addEventListener('click', clearAllComparisons);

            // Cargar datos automáticamente desde gpu_data.csv
            loadGPUDataFromCSV();
        });

        // ============================================
        // AUTO-LOAD CSV DATA
        // ============================================
        
        async function loadGPUDataFromCSV() {
            try {
                const response = await fetch('gpu_data.csv');
                if (!response.ok) {
                    // Si no existe el archivo, cargar datos demo
                    console.log('No se encontró gpu_data.csv, cargando datos demo...');
                    loadDemoData();
                    return;
                }
                const csvText = await response.text();
                processCSV(csvText);
            } catch (error) {
                console.log('Error cargando CSV, usando datos demo:', error);
                loadDemoData();
            }
        }
    </script>
</body>

</html>
